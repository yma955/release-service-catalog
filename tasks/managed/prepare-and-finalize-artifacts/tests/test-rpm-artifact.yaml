---
apiVersion: tekton.dev/v1
kind: Pipeline
metadata:
  name: test-prepare-and-finalize-artifacts-rpm-priority
spec:
  description: |
    Test the prepare-and-finalize-artifacts task when both base and RPM artifacts are provided.
    Should prioritize and select the RPM artifact over the base artifact.
  params:
    - name: dataDir
      description: The location where data will be stored
      type: string
      default: "/var/workdir/release"
    - name: taskGitUrl
      type: string
      default: "https://github.com/konflux-ci/release-service-catalog.git"
    - name: taskGitRevision
      type: string
      default: "main"
  tasks:
    - name: run-task
      taskRef:
        name: prepare-and-finalize-artifacts
      params:
        - name: dataDir
          value: $(params.dataDir)
        - name: ociStorage
          value: "mock.registry/test-repo/my-artifact"
        - name: ociArtifactExpiresAfter
          value: "1d"
        - name: orasOptions
          value: "--insecure"
        - name: baseDataArtifact
          value: "oci:mock.registry/test-repo/base-artifact@sha256:1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
        - name: rpmDataArtifact
          value: "oci:mock.registry/test-repo/rpm-artifact@sha256:abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890"
        - name: trustedArtifactsDebug
          value: ""
        - name: taskGitUrl
          value: $(params.taskGitUrl)
        - name: taskGitRevision
          value: $(params.taskGitRevision)
          