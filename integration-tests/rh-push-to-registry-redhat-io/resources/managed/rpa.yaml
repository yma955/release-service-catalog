---
apiVersion: appstudio.redhat.com/v1alpha1
kind: ReleasePlanAdmission
metadata:
  name: ${release_plan_admission_name}
  labels:
    originating-tool: "${originating_tool}"
spec:
  applications:
    - ${application_name}
  data:
    pyxis:
      server: stage
      secret: pyxis-${component_name}
    sign:
      configMapName: "hacbs-signing-pipeline-config-staging-e2e"
      cosignSecretName: "konflux-cosign-signing-stage-${component_name}"
    mapping:
      defaults:
        tags:
          - latest
        pushSourceContainer: false
      components:
        - name: ${component_name}
          repositories:
            - url: quay.io/redhat-pending/rhtap----rh-advisories-component
    fileUpdates:
      - paths:
          - path: data/teams/stonesoup/users/shebert.yml
            replacements:
              - key: .tag_on_cluster_updates
                replacement: >-
                  |^tag_on_cluster_updates:.*|tag_on_cluster_updates: {{ .components[0].containerImage }}|
        repo: 'https://gitlab.cee.redhat.com/hacbs-release-tests/app-interface/'
        upstream_repo: 'https://gitlab.cee.redhat.com/hacbs-release-tests/app-interface/'
        ref: 'master'
  origin: ${tenant_namespace}
  pipeline:
    pipelineRef:
      params:
        - name: url
          value: "${RELEASE_CATALOG_GIT_URL}"
        - name: revision
          value: "${RELEASE_CATALOG_GIT_REVISION}"
        - name: pathInRepo
          value: pipelines/managed/rh-push-to-registry-redhat-io/rh-push-to-registry-redhat-io.yaml
      resolver: git
    serviceAccountName: ${managed_sa_name}
    timeouts:
      pipeline: 4h0m0s
      tasks: 4h0m0s
  policy: standard-${component_name}
